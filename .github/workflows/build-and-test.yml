# .github/workflows/dotnet-build.yml
name: Build Obsidian Console App

on:
  # Trigger on every push or pull-request to the default branch
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:
    name: ${{matrix.config.name}}
    runs-on: ${{matrix.config.os}}
    strategy:
      matrix:
        config:
          - name: "Windows MSVC Debug"
            os: windows-latest
            configuration: Debug
            cxx: "cl"
            generators: "Visual Studio 17 2022"
            config-folder: Debug
          - name: "Windows MSVC Release"
            os: windows-latest
            configuration: Release
            cxx: "cl"
            generators: "Visual Studio 17 2022"
            config-folder: Release
          - name: "Linux GCC Debug"
            os: ubuntu-latest
            configuration: Debug
            cxx: "g++"
            generators: "Unix Makefiles"
            config-folder: ""
          - name: "Linux GCC Release"
            os: ubuntu-latest
            configuration: Release
            cxx: "g++"
            generators: "Unix Makefiles"
            config-folder: ""
          - name: "Linux Clang Debug"
            os: ubuntu-latest
            configuration: Debug
            cxx: "clang++"
            generators: "Unix Makefiles"
            config-folder: ""
          - name: "Linux Clang Release"
            os: ubuntu-latest
            configuration: Release
            cxx: "clang++"
            generators: "Unix Makefiles"
            config-folder: ""

    steps:
    - name: ‚¨áÔ∏è  Checkout source
      uses: actions/checkout@v4

    - name: üõ†Ô∏è  Setup .NET SDK
      uses: actions/setup-dotnet@v4
      with:
        dotnet-version: '8.0.x'     # Pin to the major version you target

    - name: üì¶  Generate build files
      run: cmake -B ${{github.workspace}}/cpp-build -G "${{matrix.config.generators}}" -DCMAKE_BUILD_TYPE=${{matrix.config.configuration}}

    - name: üî®  Build ‚Äì ${{ matrix.config.configuration }}
      run: cmake --build ${{github.workspace}}/cpp-build --config ${{matrix.config.configuration}}

    - name: Run Test
      working-directory: ${{github.workspace}}/cpp-build/${{matrix.config.config-folder}}
      run: ./test-cpp-project
